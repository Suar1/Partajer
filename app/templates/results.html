<h2 id="results-title" data-i18n="results">Results</h2>
<div style="margin-bottom: 20px;">
    <button class="button export-button" type="button" id="export-pdf" data-i18n="exportPdf">Export as PDF</button>
    <button id="export-csv" class="button export-button" type="button" style="background-color:#00bcd4;" data-i18n="exportCsv">Export as CSV</button>
</div>
<div class="summary-info" style="margin-bottom: 20px;" 
     data-base-pool="{{ "%.2f"|format(meta.base_pool) if meta else '0' }}"
     data-role-pool="{{ "%.2f"|format(meta.role_pool) if meta else '0' }}"
     data-property-pool="{{ "%.2f"|format(meta.property_pool) if meta else '0' }}"
     data-cash-total="{{ "%.2f"|format(meta.cash_total) if meta else '0' }}">
        <strong data-i18n="projectCostLbl">Project Cost:</strong> €{{ "%.2f"|format(meta.project_cost) }}<br>
        <strong data-i18n="salePriceLbl">Project Sale Price:</strong> €{{ "%.2f"|format(meta.sale_price) }}<br>
        <strong data-i18n="totalProfitLbl">Total Profit:</strong> €{{ "%.2f"|format(meta.project_profit) }}<br>
        <strong data-i18n="cashInvestLbl">Cash Investment (excl. property):</strong> €{{ "%.2f"|format(meta.cash_total) }}<br>
        {% if meta.property_value and meta.property_value > 0 %}
        <strong data-i18n="propertyContribLbl">Property Contribution:</strong> €{{ "%.2f"|format(meta.property_value) }}<br>
        <strong data-i18n="propertyEquityLbl">Property Equity Pool:</strong> {{ "%.2f"|format(meta.property_base_share) }}%<br>
        <strong data-i18n="propertyProfitLbl">Property Profit Pool:</strong> {{ "%.2f"|format(meta.property_profit_share_effective) }}%<br>
        {% endif %}
        <strong>Developer Bonus:</strong> {{ "%.2f"|format(meta.developer_bonus) }}%<br>
        <strong>Constructor Bonus:</strong> {{ "%.2f"|format(meta.constructor_bonus) }}%<br>
        <strong>Investor Bonus:</strong> {{ "%.2f"|format(meta.investor_bonus) }}%
    </div>
    
    <div id="share-budget-breakdown" class="summary-info" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
        <h3 style="margin-top: 0;" data-i18n="summary">Share Budget Breakdown</h3>
        <div><strong data-i18n="basePool">Base Pool:</strong> {{ "%.2f"|format(meta.base_pool) }}%</div>
        <div><strong data-i18n="rolePools">Role Pools:</strong> <span data-i18n="dev">Dev</span> {{ "%.2f"|format(meta.developer_bonus) }}%, <span data-i18n="const">Const</span> {{ "%.2f"|format(meta.constructor_bonus) }}%, <span data-i18n="inv">Inv</span> {{ "%.2f"|format(meta.investor_bonus) }}% (<span data-i18n="sum">sum</span> {{ "%.2f"|format(meta.role_pool) }}%)</div>
        {% if meta.property_pool > 0 %}
        <div><strong data-i18n="propertyPool">Property Pool:</strong> Base {{ "%.2f"|format(meta.property_base_share) }}% + Profit {{ "%.2f"|format(meta.property_profit_share_effective) }}% = {{ "%.2f"|format(meta.property_pool) }}%</div>
        {% endif %}
        <div style="margin-top: 10px; font-weight: bold;"><strong data-i18n="total">Total:</strong> {{ "%.2f"|format(meta.total_pct_sum) }}%</div>
    </div>
    
    <table>
        <tr>
            <th data-i18n="thName">Name</th>
            <th data-i18n="thRole">Role</th>
            <th data-i18n="thPayment">Payment (€)</th>
            <th data-i18n="thBaseShare">Base Share (%)</th>
            <th data-i18n="thRoleBonus">Role Bonus (%)</th>
            <th data-i18n="thPropShare">Property Share (%)</th>
            <th data-i18n="thEquityShare">Equity Share (%)</th>
            <th data-i18n="thProfitShare">Profit Share (%)</th>
            <th data-i18n="thFinalValue">Final Share Value (€)</th>
            <th data-i18n="thProfitValue">Profit Value (€)</th>
        </tr>
        {% for result in results %}
        <tr>
            <td>{{ result.name }}</td>
            <td class="role-cell" data-role="{{ result.role }}">{{ result.role }}</td>
            <td>{{ "%.2f"|format(result.payment) }}</td>
            <td>{{ "%.2f"|format(result.share) }}</td>
            <td>{{ "%.2f"|format(result.bonus) }}</td>
            <td>{{ "%.2f"|format(result.profit_bonus) }}</td>
            <td>{{ "%.2f"|format(result.total_share) }}</td>
            <td>{{ "%.2f"|format(result.profit_share if result.profit_share is not none else result.total_share) }}</td>
            <td>{{ "%.2f"|format(meta.sale_price * result.total_share / 100) }}</td>
            <td>{{ "%.2f"|format(meta.project_profit * (result.profit_share if result.profit_share is not none else result.total_share) / 100) }}</td>
        </tr>
        {% endfor %}
        <tr style="font-weight: bold; background-color: #f8f9fa;">
            <td colspan="2" data-i18n="totalsRow">Totals</td>
            <td>{{ "%.2f"|format(meta.cash_total) }}</td>
            <td>{{ "%.2f"|format(meta.total_base_shares) }}</td>
            <td>{{ "%.2f"|format(meta.total_role_bonuses) }}</td>
            <td>{{ "%.2f"|format(meta.total_property_shares) }}</td>
            <td>{{ "%.2f"|format(meta.total_pct_sum_equity) }}</td>
            <td>{{ "%.2f"|format(meta.total_pct_sum_profit) }}</td>
            <td>{{ "%.2f"|format(meta.sale_price) }}</td>
            <td>{{ "%.2f"|format(meta.project_profit) }}</td>
        </tr>
    </table>
    
    {% if meta.total_pct_sum > 100.02 or meta.total_pct_sum < 99.98 %}
    <div class="warning" style="margin-top: 20px;">
        <strong>Warning:</strong> Total shares ({{ "%.2f"|format(meta.total_pct_sum) }}%) deviate from 100% by more than ±0.02%. 
        This may be due to rounding. Please review the calculation.
    </div>
    {% endif %}
</div>

